<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§æ¨¡å‹å¯¹é½æŠ€æœ¯æ¼”è¿›å›¾è°± (Data Driven)</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link rel="stylesheet" href="../../../../styles/map-theme.css">
    <style>
        .chart-wrapper {
            position: relative;
            width: 100%;
            max-width: 1200px;
        }

        #chart-container {
            width: 100%;
            height: 650px;
            background: #161b22;
            border-radius: 12px;
            border: 1px solid #30363d;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }

        #loading-msg {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #58a6ff;
            font-size: 18px;
            display: none;
            z-index: 10;
            pointer-events: none;
        }

        .legend-info {
            margin-top: 20px;
            display: flex;
            gap: 20px;
            font-size: 13px;
            color: #8b949e;
            background: #161b22;
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid #30363d;
        }
        .legend-info span { font-weight: bold; margin-right: 5px; color: #fff; }

        .shape-filter {
            margin-top: 20px;
            display: flex;
            gap: 20px;
            font-size: 13px;
            color: #8b949e;
            background: #161b22;
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid #30363d;
            justify-content: center;
        }

        .shape-filter label {
            color: #8b949e;
        }

        .shape-filter input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .shape-filter label:hover {
            color: #fff;
        }

        body.light-theme .shape-filter {
            background: #ffffff;
            border-color: #d0d7de;
            color: #57606a;
        }

        body.light-theme .shape-filter label {
            color: #57606a;
        }

        body.light-theme .shape-filter label:hover {
            color: #24292f;
        }

        #data-stats {
            margin-top: 8px;
            font-size: 13px;
            color: #8b949e;
            text-align: center;
        }

        body.light-theme #chart-container {
            background: #ffffff;
            border-color: #d0d7de;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        body.light-theme .legend-info {
            background: #ffffff;
            border-color: #d0d7de;
            color: #57606a;
        }
        body.light-theme .legend-info span {
            color: #24292f;
        }
        body.light-theme #data-stats {
            color: #57606a;
        }
        body.light-theme #loading-msg {
            color: #0969da;
        }

        /* è¯¦æƒ…æ¨¡æ€æ¡†æ ·å¼ */
        .detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .detail-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
        }

        body.light-theme .modal-content {
            background: white;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e1e4e8;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #24292f;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #8b949e;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: #f3f4f6;
            color: #24292f;
        }

        .back-btn {
            background: #f6f8fa;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 14px;
            cursor: pointer;
            color: #24292f;
            transition: all 0.2s;
            margin-right: 10px;
        }

        .back-btn:hover {
            background: #f3f4f6;
            border-color: #8b949e;
        }

        .detail-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #24292f;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-content {
            background: #f6f8fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #0969da;
        }

        .verification-levels {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .verification-level-item {
            border: 1px solid #d0d7de;
            border-radius: 8px;
            overflow: hidden;
            background: #f6f8fa;
        }

        .verification-badge {
            padding: 12px 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .verification-badge-header {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .verification-expand-icon {
            font-size: 14px;
            transition: transform 0.3s;
        }

        .verification-badge.expanded .verification-expand-icon {
            transform: rotate(90deg);
        }

        .verification-badge.level-a {
            background: #dafbe1;
            color: #1a7f37;
            border-color: #2da44e;
        }

        .verification-badge.level-b {
            background: #fff8c5;
            color: #9a6700;
            border-color: #bf8700;
        }

        .verification-badge.level-c {
            background: #ffebe9;
            color: #cf222e;
            border-color: #da3633;
        }

        .verification-badge:hover {
            background: rgba(0,0,0,0.05);
        }

        .verification-badge.level-a:hover {
            background: #c8f4d3;
        }

        .verification-badge.level-b:hover {
            background: #fff3b5;
        }

        .verification-badge.level-c:hover {
            background: #ffe0dd;
        }

        .verification-experiments-list {
            display: none;
            padding: 15px;
            background: white;
            border-top: 1px solid #d0d7de;
        }

        .verification-experiments-list.active {
            display: block;
        }

        .verification-count {
            font-size: 12px;
            opacity: 0.8;
            margin-left: 8px;
        }

        .similar-points-list {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #d0d7de;
        }

        .similar-points-list.active {
            display: block;
        }

        .similar-point-item {
            padding: 12px;
            margin-bottom: 10px;
            background: #f6f8fa;
            border-radius: 6px;
            border-left: 3px solid #0969da;
            cursor: pointer;
            transition: all 0.2s;
        }

        .similar-point-item:hover {
            background: #e1e4e8;
            transform: translateX(4px);
        }

        .similar-point-name {
            font-weight: 600;
            color: #24292f;
            margin-bottom: 4px;
        }

        .similar-point-desc {
            font-size: 13px;
            color: #57606a;
        }

        .link-item {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #0969da;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 6px;
            background: #f6f8fa;
            transition: all 0.2s;
        }

        .link-item:hover {
            background: #e1e4e8;
            text-decoration: underline;
        }

        .comment-section {
            max-height: 200px;
            overflow-y: auto;
        }

        .comment-item {
            padding: 10px;
            margin-bottom: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #d0d7de;
        }

        .comment-author {
            font-weight: 600;
            color: #24292f;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .comment-text {
            font-size: 13px;
            color: #57606a;
            line-height: 1.5;
        }
    </style>
</head>
<body>

    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="breadcrumb">
        <a href="../../../home.html">é¦–é¡µ</a>
        <span> / </span>
        <a href="../../engineering.html">å·¥ç§‘</a>
        <span> / </span>
        <a href="../../computer.html">è®¡ç®—æœº</a>
        <span> / </span>
        <a href="../../llm-algorithm.html">å¤§æ¨¡å‹ç®—æ³•</a>
        <span> / </span>
        <span class="current">åè®­ç»ƒå¯¹é½</span>
    </div>

    <!-- æ ‡é¢˜åŒº -->
    <h1>å¤§æ¨¡å‹å¯¹é½æŠ€æœ¯æ¼”è¿›å›¾è°±</h1>
    <div class="subtitle">
        åŸºäºç§‘ç ”ä»·å€¼ç­›é€‰çš„æ ¸å¿ƒæ ·æœ¬ç‚¹å±•ç¤º<br>
        Xè½´ï¼šæ—¶é—´ | Yè½´ï¼šæ–¹æ³•æ•ˆç‡ä¸å½±å“åŠ›
    </div>

    <!-- ä¸»é¢˜åˆ‡æ¢ -->
    <div class="theme-toggle">
        <button id="theme-toggle-btn">åˆ‡æ¢ä¸ºæµ…è‰²èƒŒæ™¯</button>
    </div>

    <!-- å›¾è¡¨å®¹å™¨ -->
    <div class="chart-wrapper">
        <div id="chart-container"></div>
        <div id="loading-msg">æ­£åœ¨åŠ è½½æ•°æ®...</div>
    </div>

    <!-- å½¢çŠ¶ç­›é€‰å™¨ -->
    <div class="shape-filter">
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none;">
            <input type="checkbox" id="filter-general" checked>
            <span>â—</span>
            <span>é€šç”¨å¯¹è¯ (General Chat)</span>
        </label>
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none;">
            <input type="checkbox" id="filter-reasoning" checked>
            <span>â–²</span>
            <span>æ•°å­¦/æ¨ç† (Reasoning)</span>
        </label>
    </div>

    <!-- é™æ€è¾…åŠ©å›¾ä¾‹ -->
    <div class="legend-info">
        <div><span>â—</span> é€šç”¨å¯¹è¯ (General Chat)</div>
        <div><span>â–²</span> æ•°å­¦/æ¨ç† (Reasoning)</div>
    </div>

    <!-- æ•°æ®ç»Ÿè®¡ -->
    <div id="data-stats"></div>

    <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="detail-modal" class="detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <button class="back-btn" id="back-btn" style="display: none;">â† è¿”å›</button>
                <h2 class="modal-title" id="modal-title">è¯¦æƒ…</h2>
                <button class="close-btn" id="close-modal">&times;</button>
            </div>
            <div id="modal-body">
                <!-- å†…å®¹å°†é€šè¿‡ JS åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // --- é…ç½®å¸¸é‡ ---
        // æ”¯æŒé€šè¿‡ URL å‚æ•°æŒ‡å®šæ•°æ®æ–‡ä»¶ï¼Œä¾‹å¦‚: ?data=data.json
        // å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨å½“å‰ç›®å½•çš„ data.json
        const urlParams = new URLSearchParams(window.location.search);
        const dataFile = urlParams.get('data') || 'data.json';
        const domainParam = urlParams.get('domain') || ''; // è·å–é¢†åŸŸå‚æ•°
        
        const CONFIG = {
            // æ•°æ®æ–‡ä»¶è·¯å¾„ï¼ˆå¯é€šè¿‡ URL å‚æ•° ?data=xxx.json æŒ‡å®šï¼‰
            jsonUrl: `${dataFile}?v=${Date.now()}`,
            // ä»sampleç›®å½•åŠ è½½æ‰€æœ‰JSONæ–‡ä»¶
            sampleDir: './',
            colors: {
                // ä¸»è¦åŸºäº method_type å­—æ®µ
                'RLHF': '#e3b341',
                'RLVR': '#58a6ff',
                'RLAIF': '#f85149',
                'Direct Alignment': '#3fb950',
                'SFT / Distillation': '#a371f7',
                'PRM': '#ffb6c1',
                // å¦‚æœæ²¡æœ‰ method_typeï¼Œå›é€€åˆ° category
                'reinforcement_learning': '#e3b341',
                'preference_optimization': '#3fb950',
                'Unknown': '#888888'
            },
            shapes: {
                'general': 'circle',
                'reasoning': 'triangle'
            }
        };

        // æ ¹æ®URLå‚æ•°è®¾ç½®é»˜è®¤å‹¾é€‰çŠ¶æ€
        const filterGeneral = document.getElementById('filter-general');
        const filterReasoning = document.getElementById('filter-reasoning');
        
        if (domainParam === 'general') {
            filterGeneral.checked = true;
            filterReasoning.checked = false;
        } else if (domainParam === 'reasoning') {
            filterGeneral.checked = false;
            filterReasoning.checked = true;
        } else {
            // é»˜è®¤éƒ½å‹¾é€‰
            filterGeneral.checked = true;
            filterReasoning.checked = true;
        }

        // --- ä¸»é¢˜é…ç½® ---
        const THEME_STYLES = {
            dark: {
                text: '#c9d1d9',
                muted: '#8b949e',
                border: '#30363d',
                grid: '#30363d',
                tooltipBg: 'rgba(22, 27, 34, 0.95)'
            },
            light: {
                text: '#24292f',
                muted: '#57606a',
                border: '#d0d7de',
                grid: '#d0d7de',
                tooltipBg: 'rgba(255, 255, 255, 0.98)'
            }
        };

        let currentTheme = 'light';
        let lastOption = null;
        let allData = []; // å­˜å‚¨æ‰€æœ‰æ•°æ®ç”¨äºæŸ¥æ‰¾ç›¸ä¼¼ç‚¹
        let filteredData = []; // å­˜å‚¨è¿‡æ»¤åçš„æ•°æ®
        let verificationData = {}; // å­˜å‚¨éªŒè¯å®éªŒæ•°æ®
        let commentsData = {}; // å­˜å‚¨è¯„è®ºæ•°æ®
        let seriesListCache = null; // ç¼“å­˜ç³»åˆ—æ•°æ®

        // --- åˆå§‹åŒ– ECharts ---
        const chartDom = document.getElementById('chart-container');
        const loadingMsg = document.getElementById('loading-msg');
        const dataStats = document.getElementById('data-stats');
        const themeToggleBtn = document.getElementById('theme-toggle-btn');
        const myChart = echarts.init(chartDom, 'light');
        const detailModal = document.getElementById('detail-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const backBtn = document.getElementById('back-btn');
        let originalItem = null; // å­˜å‚¨åŸå§‹æ•°æ®ç‚¹ï¼Œç”¨äºè¿”å›
        
        // é»˜è®¤åº”ç”¨æµ…è‰²ä¸»é¢˜
        document.body.classList.add('light-theme');
        if (themeToggleBtn) {
            themeToggleBtn.textContent = 'åˆ‡æ¢ä¸ºå¤œé—´èƒŒæ™¯';
        }

        // ç”Ÿæˆæ¨¡æ‹Ÿçš„éªŒè¯æ•°æ®å’Œç›¸ä¼¼ç‚¹
        function generateVerificationData(item) {
            const levels = ['A', 'B', 'C'];
            const randomLevel = levels[Math.floor(Math.random() * levels.length)];
            const counts = {
                'A': Math.floor(Math.random() * 50) + 20,
                'B': Math.floor(Math.random() * 30) + 10,
                'C': Math.floor(Math.random() * 20) + 5
            };
            
            return {
                level: randomLevel,
                counts: counts,
                total: counts[randomLevel]
            };
        }

        // æŸ¥æ‰¾åŸºäºç›¸åŒå®éªŒæ¡ä»¶å¤ç°çš„éªŒè¯å®éªŒæ•°æ®ç‚¹
        function findSimilarPoints(currentItem) {
            let modelVerificationData = [];
            
            // å°è¯•å¤šç§å¯èƒ½çš„ key æ ¼å¼æ¥åŒ¹é… verificationData
            if (currentItem.id && verificationData[currentItem.id]) {
                modelVerificationData = verificationData[currentItem.id];
            } else {
                // å°è¯•é€šè¿‡ name åŒ¹é…ï¼ˆè½¬æ¢ä¸ºå°å†™ï¼Œæ›¿æ¢ç©ºæ ¼ä¸ºä¸‹åˆ’çº¿ï¼Œç§»é™¤ç‰¹æ®Šå­—ç¬¦ï¼‰
                const nameKey = currentItem.name.toLowerCase()
                    .replace(/\s+/g, '_')
                    .replace(/[^a-z0-9_]/g, '');
                
                if (verificationData[nameKey]) {
                    modelVerificationData = verificationData[nameKey];
                } else {
                    // å°è¯•ç›´æ¥ä½¿ç”¨ idï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                    const idKey = currentItem.id ? currentItem.id.toLowerCase() : '';
                    if (idKey && verificationData[idKey]) {
                        modelVerificationData = verificationData[idKey];
                    }
                }
            }
            
            // åŸºäºç›¸åŒçš„å®éªŒæ¡ä»¶ï¼ˆconditionsï¼‰è¿‡æ»¤éªŒè¯å®éªŒ
            const filteredByConditions = modelVerificationData.filter(item =>
                item.conditions === currentItem.conditions
            );
            
            // æŒ‰éªŒè¯çº§åˆ«åˆ†ç»„
            const verificationByLevel = { A: [], B: [], C: [] };
            filteredByConditions.forEach(vItem => {
                if (vItem.verificationLevel && verificationByLevel[vItem.verificationLevel]) {
                    verificationByLevel[vItem.verificationLevel].push(vItem);
                }
            });
            
            return verificationByLevel;
        }

        // æ ¹æ®å½¢çŠ¶ç­›é€‰è¿‡æ»¤æ•°æ®
        function filterDataByShape(data) {
            const showGeneral = filterGeneral.checked;
            const showReasoning = filterReasoning.checked;
            
            if (showGeneral && showReasoning) {
                return data; // æ˜¾ç¤ºæ‰€æœ‰æ•°æ®
            } else if (showGeneral) {
                return data.filter(item => item.domain === 'general');
            } else if (showReasoning) {
                return data.filter(item => item.domain === 'reasoning');
            } else {
                return []; // éƒ½ä¸å‹¾é€‰æ—¶è¿”å›ç©ºæ•°ç»„
            }
        }

        // æ›´æ–°å›¾è¡¨æ•°æ®
        function updateChart() {
            filteredData = filterDataByShape(allData);
            
            const seriesGroups = {};
            
            Object.keys(CONFIG.colors).forEach(groupName => {
                seriesGroups[groupName] = [];
            });

            const totalCount = allData.length;
            let usedCount = 0;
            let skippedCount = 0;

            filteredData.forEach(item => {
                // ç¡®ä¿clusterå­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨'Unknown'
                const cluster = item.cluster || 'Unknown';
                if (!seriesGroups[cluster]) {
                    seriesGroups[cluster] = [];
                }

                const dateValue = item.date;
                const valueNum = typeof item.value === 'number' ? item.value : Number(item.value);

                if (!dateValue || Number.isNaN(new Date(dateValue).getTime()) || Number.isNaN(valueNum)) {
                    skippedCount++;
                    console.warn('è·³è¿‡æ— æ•ˆæ•°æ®ç‚¹:', item);
                    return;
                }

                seriesGroups[cluster].push({
                    name: item.name,
                    value: [dateValue, valueNum],
                    symbol: CONFIG.shapes[item.domain] || 'circle',
                    symbolSize: item.domain === 'reasoning' ? 18 : 14,
                    customData: item 
                });

                usedCount++;
            });

            if (dataStats) {
                dataStats.textContent = `å½“å‰å±•ç¤º ${usedCount} / ${totalCount} ä¸ªæ•°æ®ç‚¹`;
            }

            const seriesList = Object.keys(seriesGroups).map(groupName => {
                // è·å–é¢œè‰²ï¼Œæ”¯æŒå¤šç§å¯èƒ½çš„é”®å
                let color = CONFIG.colors[groupName];
                if (!color) {
                    // å°è¯•åŒ¹é…éƒ¨åˆ†é”®å
                    const matchedKey = Object.keys(CONFIG.colors).find(key => 
                        groupName.includes(key) || key.includes(groupName)
                    );
                    color = matchedKey ? CONFIG.colors[matchedKey] : '#888';
                }
                
                return {
                    name: groupName,
                    type: 'scatter',
                    itemStyle: { 
                        color: color
                    },
                    data: seriesGroups[groupName],
                    markPoint: {
                        data: [{type: 'max', name: 'Max'}]
                    }
                };
            });

            seriesListCache = seriesList;

            const theme = THEME_STYLES[currentTheme];

            const option = {
                backgroundColor: 'transparent',
                tooltip: {
                    trigger: 'item',
                    backgroundColor: theme.tooltipBg,
                    borderColor: theme.border,
                    textStyle: { color: theme.text },
                    padding: 15,
                    formatter: function (params) {
                        const info = params.data.customData;
                        if (!info) return '';
                        
                        return `
                            <div style="font-size: 16px; font-weight: bold; color: ${params.color}; margin-bottom: 5px;">
                                ${info.name}
                            </div>
                            <div style="font-size: 12px; color: #8b949e; margin-bottom: 10px;">
                                ğŸ“… ${info.date} &nbsp;|&nbsp; ğŸ·ï¸ ${info.cluster}
                            </div>
                            <div style="border-top: 1px solid #30363d; padding-top: 8px; font-size: 13px;">
                                <b style="color:#fff">ğŸ“Œ æ ¸å¿ƒæ¡ä»¶ (Representative Conditions):</b><br>
                                <span style="color: #d2a8ff;">${info.conditions}</span>
                            </div>
                            <div style="margin-top: 8px; font-size: 13px;">
                                <b style="color:#fff">ğŸ“Š å®éªŒæ•ˆæœ (Experimental Results):</b><br>
                                <span style="color: #7ee787;">${info.result}</span>
                            </div>
                        `;
                    }
                },
                toolbox: {
                    right: 20,
                    top: 15,
                    feature: {
                        dataZoom: { yAxisIndex: 'none' },
                        restore: {},
                        saveAsImage: {}
                    },
                    iconStyle: {
                        borderColor: theme.muted
                    }
                },
                legend: {
                    data: Object.keys(seriesGroups),
                    bottom: 10,
                    textStyle: { color: theme.muted }
                },
                grid: { top: '10%', left: '5%', right: '10%', bottom: '15%', containLabel: true },
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: 0,
                        filterMode: 'none'
                    },
                    {
                        type: 'inside',
                        yAxisIndex: 0,
                        filterMode: 'none'
                    }
                ],
                xAxis: {
                    type: 'time',
                    name: 'æ—¶é—´ (Time)',
                    nameTextStyle: { color: theme.muted },
                    axisLabel: { 
                        color: theme.muted, 
                        formatter: function(value) {
                            const date = new Date(value);
                            return date.getFullYear() + '-' + String(date.getMonth() + 1).padStart(2, '0');
                        }
                    },
                    splitLine: { show: true, lineStyle: { color: theme.grid, type: 'dashed' } }
                },
                yAxis: {
                    type: 'value',
                    name: 'æ€§èƒ½è¯„åˆ†',
                    nameTextStyle: { color: theme.muted },
                    axisLabel: { show: false },
                    splitLine: { show: true, lineStyle: { color: theme.grid, opacity: 0.3 } },
                    min: 2, max: 11
                },
                series: seriesList
            };

            lastOption = option;
            myChart.setOption(option, true);
        }

        // è½¬æ¢æ–°JSONæ ¼å¼åˆ°å›¾è¡¨æ ¼å¼
        function transformNewJsonFormat(jsonData, fileName) {
            // ä¼˜å…ˆä»URLæå–æ—¥æœŸ
            let defaultDate = new Date().toISOString().split('T')[0];
            
            if (jsonData.URL) {
                // arXiv URLæ ¼å¼ï¼šhttps://arxiv.org/abs/YYMM.NNNNN
                // ä¾‹å¦‚ï¼š1502.05477 -> 2015å¹´2æœˆ, 2307.04964 -> 2023å¹´7æœˆ
                const arxivMatch = jsonData.URL.match(/arxiv\.org\/abs\/(\d{4})\.(\d+)/);
                if (arxivMatch) {
                    const idPart = arxivMatch[1]; // YYMMæ ¼å¼
                    const yy = parseInt(idPart.substring(0, 2));
                    const mm = idPart.substring(2, 4);
                    
                    // åˆ¤æ–­å¹´ä»½ï¼šå¦‚æœYY < 50ï¼Œè®¤ä¸ºæ˜¯20xxå¹´ï¼Œå¦åˆ™æ˜¯19xxå¹´
                    const year = yy < 50 ? `20${idPart.substring(0, 2)}` : `19${idPart.substring(0, 2)}`;
                    defaultDate = `${year}-${mm}-01`;
                }
            }
            
            // å¦‚æœURLä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œå°è¯•ä»æ–‡ä»¶åæå–æ—¥æœŸ
            if (defaultDate === new Date().toISOString().split('T')[0]) {
                const dateMatch = fileName.match(/(\d{4})[-_](\d{2})[-_](\d{2})/);
                if (dateMatch) {
                    defaultDate = `${dateMatch[1]}-${dateMatch[2]}-${dateMatch[3]}`;
                }
            }
            
            // ç¡®å®šåˆ†ç»„ï¼ˆä¸»è¦åŸºäºmethod_typeå­—æ®µï¼‰
            const cluster = jsonData.method_type || jsonData.category || 'Unknown';
            
            // å¦‚æœæ²¡æœ‰method_typeä½†æœ‰categoryï¼Œå°è¯•ä»categoryæ¨æ–­method_type
            if (!jsonData.method_type && jsonData.category) {
                // å¯ä»¥æ ¹æ®categoryåšæ˜ å°„ï¼Œä½†ä¼˜å…ˆä¿æŒmethod_typeä¸ºç©ºæ—¶çš„å¤„ç†
            }
            
            // ç¡®å®šé¢†åŸŸï¼ˆä»categoryæˆ–å…¶ä»–å­—æ®µæ¨æ–­ï¼‰
            let domain = 'general';
            if (jsonData.category === 'reasoning' || 
                (jsonData.method_type && jsonData.method_type.includes('RLVR')) ||
                (jsonData.full_name && jsonData.full_name.toLowerCase().includes('reasoning'))) {
                domain = 'reasoning';
            }
            
            // è®¡ç®—valueï¼ˆåŸºäºempirical_resultsæˆ–å…¶ä»–æŒ‡æ ‡ï¼‰
            let value = 5; // é»˜è®¤å€¼
            if (jsonData.empirical_results && jsonData.empirical_results.in_domain) {
                const inDomain = jsonData.empirical_results.in_domain;
                // å°è¯•æå–æ€§èƒ½æŒ‡æ ‡
                if (typeof inDomain === 'object') {
                    const keys = Object.keys(inDomain);
                    if (keys.length > 0) {
                        value = Math.min(10, 5 + keys.length * 0.5);
                    }
                }
            }
            
            // æ„å»ºconditionsï¼ˆæ ¸å¿ƒæ¡ä»¶ï¼‰
            const conditions = [
                jsonData.data_source?.sampling_strategy ? `é‡‡æ ·ç­–ç•¥: ${jsonData.data_source.sampling_strategy}` : '',
                jsonData.reward_function?.type ? `å¥–åŠ±ç±»å‹: ${jsonData.reward_function.type}` : '',
                jsonData.reward_function?.granularity ? `å¥–åŠ±ç²’åº¦: ${jsonData.reward_function.granularity}` : '',
                jsonData.training_paradigm?.iterative !== undefined ? `è¿­ä»£è®­ç»ƒ: ${jsonData.training_paradigm.iterative ? 'æ˜¯' : 'å¦'}` : ''
            ].filter(Boolean).join(' | ') || 'æœªæŒ‡å®š';
            
            // æ„å»ºresultï¼ˆå®éªŒæ•ˆæœï¼‰
            const resultParts = [];
            if (jsonData.empirical_results?.in_domain) {
                const inDomain = jsonData.empirical_results.in_domain;
                if (typeof inDomain === 'object') {
                    Object.entries(inDomain).forEach(([key, value]) => {
                        if (typeof value === 'object' && value !== null) {
                            resultParts.push(`${key}: ${JSON.stringify(value)}`);
                        } else {
                            resultParts.push(`${key}: ${value}`);
                        }
                    });
                }
            }
            const result = resultParts.length > 0 ? resultParts.join('; ') : 'å®éªŒç»“æœå¾…è¡¥å……';
            
            return {
                id: jsonData.method_name?.toLowerCase() || fileName.replace('.json', ''),
                name: jsonData.method_name || jsonData.full_name || 'Unknown',
                full_name: jsonData.full_name || jsonData.method_name || 'Unknown',
                date: defaultDate,
                cluster: cluster,
                domain: domain,
                value: value,
                conditions: conditions,
                result: result,
                // ä¿å­˜åŸå§‹æ•°æ®ä»¥ä¾¿è¯¦æƒ…æ˜¾ç¤º
                originalData: jsonData,
                // å…¼å®¹æ—§æ ¼å¼çš„å­—æ®µ
                source: jsonData.URL || '',
                paperUrl: jsonData.URL || '',
                codeUrl: jsonData.open_source_components?.code || '',
                githubUrl: jsonData.open_source_components?.code || ''
            };
        }

        // --- æ ¸å¿ƒé€»è¾‘å‡½æ•° ---
        async function initChart() {
            try {
                if (loadingMsg) {
                    loadingMsg.style.display = 'block';
                }

                // åŠ è½½sampleç›®å½•ä¸‹çš„æ‰€æœ‰JSONæ–‡ä»¶
                const jsonFiles = [
                    'PPO.json',
                    'PPO_Max.json',
                    'DPO.json',
                    'GRPO.json',
                    'GSPO.json',
                    'DAPO.json',
                    'TRPO.json'
                ];
                
                const loadPromises = jsonFiles.map(async (fileName) => {
                    try {
                        const response = await fetch(`${CONFIG.sampleDir}${fileName}?v=${Date.now()}`);
                        if (!response.ok) {
                            console.warn(`æ— æ³•åŠ è½½ ${fileName}`);
                            return null;
                        }
                        const data = await response.json();
                        return { data, fileName };
                    } catch (error) {
                        console.warn(`åŠ è½½ ${fileName} å¤±è´¥:`, error);
                        return null;
                    }
                });
                
                const loadedFiles = await Promise.all(loadPromises);
                const validFiles = loadedFiles.filter(f => f !== null);
                
                // è½¬æ¢æ•°æ®æ ¼å¼
                allData = validFiles.map(({ data, fileName }) => 
                    transformNewJsonFormat(data, fileName)
                );
                
                // åŠ è½½éªŒè¯å®éªŒæ•°æ®ï¼ˆä»åŒç›®å½•åŠ è½½ï¼Œå¯é€‰æ–‡ä»¶ï¼Œä¸å­˜åœ¨æ—¶é™é»˜å¿½ç•¥ï¼‰
                try {
                    const verificationResponse = await fetch(`verification-data.json?v=${Date.now()}`);
                    if (verificationResponse.ok) {
                        verificationData = await verificationResponse.json();
                    } else {
                        verificationData = {}; // æ–‡ä»¶ä¸å­˜åœ¨æ—¶ä½¿ç”¨ç©ºå¯¹è±¡
                    }
                } catch (e) {
                    // ç½‘ç»œé”™è¯¯æ—¶é™é»˜å¿½ç•¥
                    verificationData = {};
                }
                
                // åŠ è½½è¯„è®ºæ•°æ®ï¼ˆä»åŒç›®å½•åŠ è½½ï¼Œå¯é€‰æ–‡ä»¶ï¼Œä¸å­˜åœ¨æ—¶é™é»˜å¿½ç•¥ï¼‰
                try {
                    const commentsResponse = await fetch(`comments-data.json?v=${Date.now()}`);
                    if (commentsResponse.ok) {
                        commentsData = await commentsResponse.json();
                    } else {
                        commentsData = {}; // æ–‡ä»¶ä¸å­˜åœ¨æ—¶ä½¿ç”¨ç©ºå¯¹è±¡
                    }
                } catch (e) {
                    // ç½‘ç»œé”™è¯¯æ—¶é™é»˜å¿½ç•¥
                    commentsData = {};
                }

                // ä½¿ç”¨è¿‡æ»¤å‡½æ•°æ›´æ–°å›¾è¡¨
                updateChart();
                
                console.info(
                    `å¯¹é½å›¾è°±: ä» ${validFiles.length} ä¸ªJSONæ–‡ä»¶è¯»å– ${allData.length} æ¡è®°å½•, å½“å‰æ˜¾ç¤º ${filteredData.length} æ¡ã€‚`
                );
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬
                myChart.on('click', function(params) {
                    if (params.data && params.data.customData) {
                        _showDetailModalInternal(params.data.customData);
                    }
                });
                
                if (loadingMsg) {
                    loadingMsg.style.display = 'none';
                }

            } catch (error) {
                console.error('æ•°æ®åŠ è½½é”™è¯¯:', error);
                let errorMsg = 'æ•°æ®åŠ è½½å¤±è´¥: ' + error.message;
                if (error.message.includes('Failed to fetch') || error.message.includes('CORS')) {
                    errorMsg += '<br><br>æç¤ºï¼šè¯·ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨è¿è¡Œï¼ˆå¦‚ Python: python -m http.server æˆ– VS Code Live Serverï¼‰';
                }
                if (loadingMsg) {
                    loadingMsg.innerHTML = errorMsg;
                    loadingMsg.style.color = '#f85149';
                    loadingMsg.style.display = 'block';
                }
            }
        }

        // --- ä¸»é¢˜åˆ‡æ¢é€»è¾‘ ---
        function applyThemeToChart() {
            if (!lastOption) return;
            const theme = THEME_STYLES[currentTheme];
            myChart.setOption({
                tooltip: {
                    backgroundColor: theme.tooltipBg,
                    borderColor: theme.border,
                    textStyle: { color: theme.text }
                },
                legend: {
                    textStyle: { color: theme.muted }
                },
                toolbox: {
                    iconStyle: { borderColor: theme.muted }
                },
                xAxis: {
                    nameTextStyle: { color: theme.muted },
                    axisLabel: { color: theme.muted },
                    splitLine: { lineStyle: { color: theme.grid, type: 'dashed' } }
                },
                yAxis: {
                    nameTextStyle: { color: theme.muted },
                    splitLine: { lineStyle: { color: theme.grid, opacity: 0.3 } }
                }
            });
        }

        if (themeToggleBtn) {
            themeToggleBtn.addEventListener('click', () => {
                currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
                document.body.classList.toggle('light-theme', currentTheme === 'light');
                themeToggleBtn.textContent = currentTheme === 'dark' ? 'åˆ‡æ¢ä¸ºæµ…è‰²èƒŒæ™¯' : 'åˆ‡æ¢ä¸ºå¤œé—´èƒŒæ™¯';
                applyThemeToChart();
            });
        }

        // å¡«å……é»˜è®¤å®éªŒæ¡ä»¶
        function fillDefaultExperimentDetails(item) {
            if (!item.experimentDetails) {
                item.experimentDetails = {};
            }
            // æ¸…ç† undefined å€¼
            const cleanDetails = {};
            Object.keys(item.experimentDetails).forEach(key => {
                if (item.experimentDetails[key] !== undefined && item.experimentDetails[key] !== 'undefined') {
                    cleanDetails[key] = item.experimentDetails[key];
                }
            });
            
            const defaults = {
                hardware: cleanDetails.hardware || "GPUé›†ç¾¤",
                gpuCount: cleanDetails.gpuCount || "æœªè¯´æ˜",
                gpuModel: cleanDetails.gpuModel || "æœªè¯´æ˜",
                memory: cleanDetails.memory || "æœªè¯´æ˜",
                trainingTime: cleanDetails.trainingTime || cleanDetails.time || "æœªè¯´æ˜",
                totalHours: cleanDetails.totalHours || "æœªè¯´æ˜",
                epochs: cleanDetails.epochs || "æœªè¯´æ˜",
                iterations: cleanDetails.iterations || "æœªè¯´æ˜",
                dataset: cleanDetails.dataset || cleanDetails.dataSize || "æœªè¯´æ˜",
                dataSize: cleanDetails.dataSize || "æœªè¯´æ˜",
                samples: cleanDetails.samples || "æœªè¯´æ˜",
                tokens: cleanDetails.tokens || "æœªè¯´æ˜",
                hyperparameters: cleanDetails.hyperparameters || "æœªè¯´æ˜",
                learningRate: cleanDetails.learningRate || "æœªè¯´æ˜",
                batchSize: cleanDetails.batchSize || "æœªè¯´æ˜",
                modelSize: cleanDetails.modelSize || "æœªè¯´æ˜",
                trainingLog: cleanDetails.trainingLog || null,
                cost: cleanDetails.cost || null
            };
            return Object.assign({}, defaults, cleanDetails);
        }

        // å¡«å……é»˜è®¤æŒ‡æ ‡
        function fillDefaultMetrics(item) {
            if (!item.metrics) {
                item.metrics = {};
            }
            // æ¸…ç† undefined å€¼
            const cleanMetrics = {};
            Object.keys(item.metrics).forEach(key => {
                if (item.metrics[key] !== undefined && item.metrics[key] !== 'undefined') {
                    cleanMetrics[key] = item.metrics[key];
                }
            });
            
            const defaults = {
                benchmarks: cleanMetrics.benchmarks || {},
                latency: cleanMetrics.latency || "æœªè¯´æ˜",
                throughput: cleanMetrics.throughput || "æœªè¯´æ˜",
                tokensPerDollar: cleanMetrics.tokensPerDollar || null,
                reasoningSteps: cleanMetrics.reasoningSteps || null,
                performance: cleanMetrics.performance || null,
                accuracy: cleanMetrics.accuracy || null,
                efficiency: cleanMetrics.efficiency || null,
                additionalMetrics: cleanMetrics.additionalMetrics || null
            };
            return Object.assign({}, defaults, cleanMetrics);
        }

        // æ˜¾ç¤ºè¯¦æƒ…æ¨¡æ€æ¡†ï¼ˆå†…éƒ¨å‡½æ•°ï¼‰
        async function _showDetailModalInternal(item, isVerificationExperiment = false) {
            // å¦‚æœä¸æ˜¯éªŒè¯å®éªŒï¼Œä¿å­˜ä¸ºåŸå§‹æ•°æ®ç‚¹
            if (!isVerificationExperiment) {
                originalItem = item;
                if (backBtn) backBtn.style.display = 'none';
            } else {
                // å¦‚æœæ˜¯éªŒè¯å®éªŒï¼Œæ˜¾ç¤ºè¿”å›æŒ‰é’®
                if (backBtn) backBtn.style.display = 'block';
            }
            
            // å¡«å……é»˜è®¤å€¼
            const enrichedItem = {
                ...item,
                experimentDetails: fillDefaultExperimentDetails(item),
                metrics: fillDefaultMetrics(item)
            };
            
            // æŸ¥æ‰¾éªŒè¯æ•°æ®ï¼ˆåªæœ‰ééªŒè¯å®éªŒæ‰æŸ¥æ‰¾ï¼Œé¿å…åµŒå¥—ï¼‰
            const verificationByLevel = isVerificationExperiment ? { A: [], B: [], C: [] } : findSimilarPoints(enrichedItem);
            
            // è®¡ç®—å„çº§åˆ«çš„æ•°é‡ï¼ˆå®Œå…¨åŸºäºå®é™…æ•°æ®ï¼Œä¸ä½¿ç”¨éšæœºæ•°ï¼‰
            const verification = {
                counts: {
                    A: verificationByLevel.A.length,
                    B: verificationByLevel.B.length,
                    C: verificationByLevel.C.length
                },
                total: verificationByLevel.A.length + verificationByLevel.B.length + verificationByLevel.C.length
            };
            
            // ä½¿ç”¨ enrichedItem æ›¿ä»£ item
            const displayItem = enrichedItem;
            
            document.getElementById('modal-title').textContent = displayItem.name;
            
            // å¦‚æœæ˜¯éªŒè¯å®éªŒï¼Œä¸æ˜¾ç¤ºåˆ†çº§éªŒè¯éƒ¨åˆ†
            const showVerificationSection = !isVerificationExperiment;
            
            const originalData = displayItem.originalData || {};
            
            const modalBody = document.getElementById('modal-body');
            modalBody.innerHTML = `
                <div class="detail-section">
                    <div class="section-title">ğŸ“„ åŸºæœ¬ä¿¡æ¯</div>
                    <div class="section-content">
                        <p><strong>æ–¹æ³•ç®€ç§°:</strong> ${originalData.method_name || displayItem.name}</p>
                        <p><strong>æ–¹æ³•å…¨ç§°:</strong> ${originalData.full_name || displayItem.full_name}</p>
                        <p><strong>æ–¹æ³•ç±»åˆ«:</strong> ${originalData.category || 'æœªæŒ‡å®š'}</p>
                        ${originalData.method_type ? `<p><strong>æ–¹æ³•ç±»å‹:</strong> ${originalData.method_type} (${originalData.method_type_full || ''})</p>` : ''}
                        ${originalData.method_type_description ? `<p><strong>ç±»å‹æè¿°:</strong> ${originalData.method_type_description}</p>` : ''}
                        <p><strong>æ—¥æœŸ:</strong> ${displayItem.date}</p>
                        <p><strong>åˆ†ç±»:</strong> ${displayItem.cluster}</p>
                        <p><strong>é¢†åŸŸ:</strong> ${displayItem.domain === 'general' ? 'é€šç”¨å¯¹è¯' : 'æ•°å­¦/æ¨ç†'}</p>
                        <p><strong>ç§‘ç ”ä»·å€¼:</strong> ${displayItem.value}</p>
                    </div>
                </div>

                ${originalData.base_algorithm ? `
                <div class="detail-section">
                    <div class="section-title">ğŸ”¬ åŸºç¡€ç®—æ³•</div>
                    <div class="section-content">
                        ${originalData.base_algorithm.derived_from ? `<p><strong>æºè‡ªæ–¹æ³•:</strong> ${originalData.base_algorithm.derived_from}</p>` : ''}
                        ${originalData.base_algorithm.key_modification ? `<p><strong>æ ¸å¿ƒæ”¹åŠ¨ç‚¹:</strong> ${originalData.base_algorithm.key_modification}</p>` : ''}
                    </div>
                </div>
                ` : ''}

                ${originalData.data_source ? `
                <div class="detail-section">
                    <div class="section-title">ğŸ“¥ æ•°æ®æ¥æº</div>
                    <div class="section-content">
                        ${originalData.data_source.sampling_strategy ? `<p><strong>é‡‡æ ·æ–¹å¼:</strong> ${originalData.data_source.sampling_strategy}</p>` : ''}
                        ${originalData.data_source.dataset_name ? `<p><strong>æ•°æ®é›†åç§°:</strong> ${originalData.data_source.dataset_name}</p>` : ''}
                        ${originalData.data_source.dataset_description ? `<p><strong>æ•°æ®é›†æè¿°:</strong> ${originalData.data_source.dataset_description}</p>` : ''}
                        ${originalData.data_source.description ? `<p><strong>æè¿°:</strong> ${originalData.data_source.description}</p>` : ''}
                        ${originalData.data_source.preference_data ? `<p><strong>åå¥½æ•°æ®:</strong> ${originalData.data_source.preference_data}</p>` : ''}
                    </div>
                </div>
                ` : ''}

                ${originalData.reward_function ? `
                <div class="detail-section">
                    <div class="section-title">ğŸ¯ å¥–åŠ±å‡½æ•°</div>
                    <div class="section-content">
                        ${originalData.reward_function.type ? `<p><strong>å¥–åŠ±ç±»å‹:</strong> ${Array.isArray(originalData.reward_function.type) ? originalData.reward_function.type.join(', ') : originalData.reward_function.type}</p>` : ''}
                        ${originalData.reward_function.granularity ? `<p><strong>å¥–åŠ±ç²’åº¦:</strong> ${Array.isArray(originalData.reward_function.granularity) ? originalData.reward_function.granularity.join(', ') : originalData.reward_function.granularity}</p>` : ''}
                        ${originalData.reward_function.description ? `<p><strong>æè¿°:</strong> ${originalData.reward_function.description}</p>` : ''}
                        ${originalData.reward_function.verification_method ? `<p><strong>éªŒè¯æ–¹æ³•:</strong> ${typeof originalData.reward_function.verification_method === 'object' ? JSON.stringify(originalData.reward_function.verification_method, null, 2) : originalData.reward_function.verification_method}</p>` : ''}
                        ${originalData.reward_function.reward_model_training ? `<p><strong>å¥–åŠ±æ¨¡å‹è®­ç»ƒ:</strong> ${originalData.reward_function.reward_model_training}</p>` : ''}
                    </div>
                </div>
                ` : ''}

                ${originalData.gradient_coefficient ? `
                <div class="detail-section">
                    <div class="section-title">ğŸ“ˆ æ¢¯åº¦ç³»æ•°</div>
                    <div class="section-content">
                        ${typeof originalData.gradient_coefficient === 'object' ? 
                            Object.entries(originalData.gradient_coefficient).map(([key, value]) => {
                                if (value === null || value === undefined) return '';
                                if (typeof value === 'object') {
                                    return `<p><strong>${key}:</strong> ${JSON.stringify(value, null, 2)}</p>`;
                                }
                                return `<p><strong>${key}:</strong> ${value}</p>`;
                            }).join('') 
                            : `<p>${originalData.gradient_coefficient}</p>`
                        }
                    </div>
                </div>
                ` : ''}

                ${originalData.training_paradigm ? `
                <div class="detail-section">
                    <div class="section-title">ğŸ”„ è®­ç»ƒèŒƒå¼</div>
                    <div class="section-content">
                        ${originalData.training_paradigm.iterative !== undefined ? `<p><strong>æ˜¯å¦è¿­ä»£:</strong> ${originalData.training_paradigm.iterative ? 'æ˜¯' : 'å¦'}</p>` : ''}
                        ${originalData.training_paradigm.reference_model_update ? `<p><strong>å‚è€ƒæ¨¡å‹æ›´æ–°:</strong> ${originalData.training_paradigm.reference_model_update}</p>` : ''}
                        ${originalData.training_paradigm.reference_model_usage ? `<p><strong>å‚è€ƒæ¨¡å‹ä½¿ç”¨:</strong> ${originalData.training_paradigm.reference_model_usage}</p>` : ''}
                        ${originalData.training_paradigm.reward_model_update ? `<p><strong>å¥–åŠ±æ¨¡å‹æ›´æ–°:</strong> ${originalData.training_paradigm.reward_model_update}</p>` : ''}
                        ${originalData.training_paradigm.reward_model_usage ? `<p><strong>å¥–åŠ±æ¨¡å‹ä½¿ç”¨:</strong> ${originalData.training_paradigm.reward_model_usage}</p>` : ''}
                        ${originalData.training_paradigm.description ? `<p><strong>æè¿°:</strong> ${originalData.training_paradigm.description}</p>` : ''}
                        ${originalData.training_paradigm.stages ? `<p><strong>è®­ç»ƒé˜¶æ®µ:</strong> ${Array.isArray(originalData.training_paradigm.stages) ? originalData.training_paradigm.stages.join('; ') : originalData.training_paradigm.stages}</p>` : ''}
                        ${originalData.training_paradigm.training_stages ? `<p><strong>è®­ç»ƒé˜¶æ®µ:</strong> ${originalData.training_paradigm.training_stages}</p>` : ''}
                    </div>
                </div>
                ` : ''}

                ${originalData.regularization ? `
                <div class="detail-section">
                    <div class="section-title">âš–ï¸ æ­£åˆ™åŒ–</div>
                    <div class="section-content">
                        ${typeof originalData.regularization === 'object' ? 
                            Object.entries(originalData.regularization).map(([key, value]) => {
                                if (value === null || value === undefined) return '';
                                if (typeof value === 'object') {
                                    return `<p><strong>${key}:</strong> ${JSON.stringify(value, null, 2)}</p>`;
                                }
                                return `<p><strong>${key}:</strong> ${value}</p>`;
                            }).join('') 
                            : `<p>${originalData.regularization}</p>`
                        }
                    </div>
                </div>
                ` : ''}

                ${originalData.efficiency ? `
                <div class="detail-section">
                    <div class="section-title">âš¡ æ•ˆç‡</div>
                    <div class="section-content">
                        ${typeof originalData.efficiency === 'object' ? 
                            Object.entries(originalData.efficiency).map(([key, value]) => {
                                if (value === null || value === undefined) return '';
                                if (typeof value === 'object') {
                                    return `<p><strong>${key}:</strong> ${JSON.stringify(value, null, 2)}</p>`;
                                }
                                return `<p><strong>${key}:</strong> ${value}</p>`;
                            }).join('') 
                            : `<p>${originalData.efficiency}</p>`
                        }
                    </div>
                </div>
                ` : ''}

                <div class="detail-section">
                    <div class="section-title">ğŸ“Œ æ ¸å¿ƒæ¡ä»¶</div>
                    <div class="section-content">
                        <p>${displayItem.conditions}</p>
                    </div>
                </div>

                ${originalData.empirical_results ? `
                <div class="detail-section">
                    <div class="section-title">ğŸ“Š å®éªŒç»“æœ</div>
                    <div class="section-content">
                        ${originalData.empirical_results.in_domain ? `
                            <div style="margin-bottom: 15px;">
                                <div style="font-weight: 600; margin-bottom: 8px; color: #0969da;">é¢†åŸŸå†…æ•°æ®:</div>
                                <div style="padding: 12px; background: #f6f8fa; border-radius: 6px;">
                                    ${typeof originalData.empirical_results.in_domain === 'object' ? 
                                        Object.entries(originalData.empirical_results.in_domain).map(([key, value]) => {
                                            if (typeof value === 'object' && value !== null) {
                                                return `<p><strong>${key}:</strong> ${JSON.stringify(value, null, 2)}</p>`;
                                            }
                                            return `<p><strong>${key}:</strong> ${value}</p>`;
                                        }).join('') 
                                        : `<p>${originalData.empirical_results.in_domain}</p>`
                                    }
                                </div>
                            </div>
                        ` : ''}
                        ${originalData.empirical_results.out_of_domain ? `
                            <div style="margin-bottom: 15px;">
                                <div style="font-weight: 600; margin-bottom: 8px; color: #1a7f37;">é¢†åŸŸå¤–æ•°æ®:</div>
                                <div style="padding: 12px; background: #f6f8fa; border-radius: 6px;">
                                    ${typeof originalData.empirical_results.out_of_domain === 'object' ? 
                                        Object.entries(originalData.empirical_results.out_of_domain).map(([key, value]) => {
                                            if (typeof value === 'object' && value !== null) {
                                                return `<p><strong>${key}:</strong> ${JSON.stringify(value, null, 2)}</p>`;
                                            }
                                            return `<p><strong>${key}:</strong> ${value}</p>`;
                                        }).join('') 
                                        : `<p>${originalData.empirical_results.out_of_domain}</p>`
                                    }
                                </div>
                            </div>
                        ` : ''}
                        ${originalData.empirical_results.ablation_study ? `
                            <div style="margin-bottom: 15px;">
                                <div style="font-weight: 600; margin-bottom: 8px; color: #8250df;">æ¶ˆèå®éªŒ:</div>
                                <div style="padding: 12px; background: #f6f8fa; border-radius: 6px;">
                                    ${typeof originalData.empirical_results.ablation_study === 'object' ? 
                                        JSON.stringify(originalData.empirical_results.ablation_study, null, 2) 
                                        : `<p>${originalData.empirical_results.ablation_study}</p>`
                                    }
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
                ` : `
                <div class="detail-section">
                    <div class="section-title">ğŸ“Š å®éªŒæ•ˆæœ</div>
                    <div class="section-content">
                        <p>${displayItem.result}</p>
                    </div>
                </div>
                `}

                ${originalData.theoretical_insight ? `
                <div class="detail-section">
                    <div class="section-title">ğŸ§  ç†è®ºè§£é‡Š</div>
                    <div class="section-content">
                        ${typeof originalData.theoretical_insight === 'object' ? 
                            Object.entries(originalData.theoretical_insight).map(([key, value]) => {
                                if (value === null || value === undefined) return '';
                                if (Array.isArray(value)) {
                                    return `<p><strong>${key}:</strong><ul>${value.map(v => `<li>${v}</li>`).join('')}</ul></p>`;
                                }
                                if (typeof value === 'object') {
                                    return `<p><strong>${key}:</strong> ${JSON.stringify(value, null, 2)}</p>`;
                                }
                                return `<p><strong>${key}:</strong> ${value}</p>`;
                            }).join('') 
                            : `<p>${originalData.theoretical_insight}</p>`
                        }
                    </div>
                </div>
                ` : ''}

                <div class="detail-section">
                    <div class="section-title">âš™ï¸ è¯¦ç»†å®éªŒæ¡ä»¶ï¼ˆèµ„æºæ¶ˆè€—ï¼‰</div>
                    <div class="section-content">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 10px;">
                            <div style="padding: 12px; background: #f6f8fa; border-radius: 6px; border-left: 3px solid #0969da;">
                                <div style="font-weight: 600; color: #0969da; margin-bottom: 6px;">ğŸ–¥ï¸ ç¡¬ä»¶èµ„æº</div>
                                <div style="font-size: 13px; color: #57606a;">
                                    ${displayItem.experimentDetails.hardware || displayItem.experimentDetails.gpu || 'æœªè¯´æ˜'}
                                    ${displayItem.experimentDetails.gpuCount && displayItem.experimentDetails.gpuCount !== 'æœªè¯´æ˜' ? ` (${displayItem.experimentDetails.gpuCount}å—)` : ''}
                                    ${displayItem.experimentDetails.gpuModel && displayItem.experimentDetails.gpuModel !== 'æœªè¯´æ˜' ? ` - ${displayItem.experimentDetails.gpuModel}` : ''}
                                    ${displayItem.experimentDetails.memory && displayItem.experimentDetails.memory !== 'æœªè¯´æ˜' ? `<br>å†…å­˜: ${displayItem.experimentDetails.memory}` : ''}
                                    ${displayItem.experimentDetails.cpu ? `<br>CPU: ${displayItem.experimentDetails.cpu}` : ''}
                                </div>
                            </div>
                            <div style="padding: 12px; background: #f6f8fa; border-radius: 6px; border-left: 3px solid #1a7f37;">
                                <div style="font-weight: 600; color: #1a7f37; margin-bottom: 6px;">â±ï¸ æ—¶é—´æ¶ˆè€—</div>
                                <div style="font-size: 13px; color: #57606a;">
                                    ${displayItem.experimentDetails.trainingTime || displayItem.experimentDetails.time || 'æœªè¯´æ˜'}
                                    ${displayItem.experimentDetails.totalHours && displayItem.experimentDetails.totalHours !== 'æœªè¯´æ˜' ? `<br>æ€»è®­ç»ƒæ—¶é•¿: ${displayItem.experimentDetails.totalHours} å°æ—¶` : ''}
                                    ${displayItem.experimentDetails.epochs && displayItem.experimentDetails.epochs !== 'æœªè¯´æ˜' ? `<br>è®­ç»ƒè½®æ•°: ${displayItem.experimentDetails.epochs}` : ''}
                                    ${displayItem.experimentDetails.iterations && displayItem.experimentDetails.iterations !== 'æœªè¯´æ˜' ? `<br>è¿­ä»£æ¬¡æ•°: ${displayItem.experimentDetails.iterations}` : ''}
                                </div>
                            </div>
                            <div style="padding: 12px; background: #f6f8fa; border-radius: 6px; border-left: 3px solid #cf222e;">
                                <div style="font-weight: 600; color: #cf222e; margin-bottom: 6px;">ğŸ“¦ æ•°æ®é‡</div>
                                <div style="font-size: 13px; color: #57606a;">
                                    ${displayItem.experimentDetails.dataset || displayItem.experimentDetails.dataSize || 'æœªè¯´æ˜'}
                                    ${displayItem.experimentDetails.dataSize && displayItem.experimentDetails.dataSize !== 'æœªè¯´æ˜' ? `<br>æ•°æ®é›†å¤§å°: ${displayItem.experimentDetails.dataSize}` : ''}
                                    ${displayItem.experimentDetails.samples && displayItem.experimentDetails.samples !== 'æœªè¯´æ˜' ? `<br>æ ·æœ¬æ•°é‡: ${displayItem.experimentDetails.samples}` : ''}
                                    ${displayItem.experimentDetails.tokens && displayItem.experimentDetails.tokens !== 'æœªè¯´æ˜' ? `<br>Tokenæ•°: ${displayItem.experimentDetails.tokens}` : ''}
                                </div>
                            </div>
                            <div style="padding: 12px; background: #f6f8fa; border-radius: 6px; border-left: 3px solid #8250df;">
                                <div style="font-weight: 600; color: #8250df; margin-bottom: 6px;">ğŸ”§ è¶…å‚æ•°é…ç½®</div>
                                <div style="font-size: 13px; color: #57606a;">
                                    ${displayItem.experimentDetails.hyperparameters || 'æœªè¯´æ˜'}
                                    ${displayItem.experimentDetails.learningRate && displayItem.experimentDetails.learningRate !== 'æœªè¯´æ˜' ? `<br>å­¦ä¹ ç‡: ${displayItem.experimentDetails.learningRate}` : ''}
                                    ${displayItem.experimentDetails.batchSize && displayItem.experimentDetails.batchSize !== 'æœªè¯´æ˜' ? `<br>æ‰¹æ¬¡å¤§å°: ${displayItem.experimentDetails.batchSize}` : ''}
                                    ${displayItem.experimentDetails.modelSize && displayItem.experimentDetails.modelSize !== 'æœªè¯´æ˜' ? `<br>æ¨¡å‹å¤§å°: ${displayItem.experimentDetails.modelSize}` : ''}
                                </div>
                            </div>
                        </div>
                        ${displayItem.experimentDetails.trainingLog ? `
                            <div style="margin-top: 15px; padding: 12px; background: #fff8e1; border-radius: 6px; border-left: 3px solid #f59e0b;">
                                <div style="font-weight: 600; color: #f59e0b; margin-bottom: 6px;">ğŸ“‹ è®­ç»ƒæ—¥å¿—</div>
                                <div style="font-size: 13px; color: #57606a;">${displayItem.experimentDetails.trainingLog}</div>
                            </div>
                        ` : ''}
                        ${displayItem.experimentDetails.cost ? `
                            <div style="margin-top: 15px; padding: 12px; background: #f0f9ff; border-radius: 6px; border-left: 3px solid #0284c7;">
                                <div style="font-weight: 600; color: #0284c7; margin-bottom: 6px;">ğŸ’° è®¡ç®—æˆæœ¬</div>
                                <div style="font-size: 13px; color: #57606a;">${displayItem.experimentDetails.cost}</div>
                            </div>
                        ` : ''}
                    </div>
                </div>

                <div class="detail-section">
                    <div class="section-title">ğŸ“ˆ è¯¦ç»†å®éªŒæŒ‡æ ‡ï¼ˆBenchmarkç»“æœï¼‰</div>
                    <div class="section-content">
                        ${Object.keys(displayItem.metrics.benchmarks || {}).length > 0 ? `
                            <div style="margin-top: 10px;">
                                <div style="font-weight: 600; margin-bottom: 12px; color: #24292f;">æ ¸å¿ƒBenchmarkç»“æœ:</div>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 12px;">
                                    ${Object.entries(displayItem.metrics.benchmarks).map(([benchmark, value]) => `
                                        <div style="padding: 12px; background: linear-gradient(135deg, #f6f8fa 0%, #ffffff 100%); border-radius: 6px; border: 1px solid #d0d7de;">
                                            <div style="font-weight: 600; color: #0969da; margin-bottom: 6px; font-size: 14px;">${benchmark}</div>
                                            <div style="font-size: 18px; font-weight: 700; color: #24292f;">${typeof value === 'object' ? JSON.stringify(value, null, 2) : value}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                            ${displayItem.metrics.latency && displayItem.metrics.latency !== 'æœªè¯´æ˜' ? `
                                <div style="padding: 12px; background: #f6f8fa; border-radius: 6px;">
                                    <div style="font-weight: 600; color: #8250df; margin-bottom: 6px; font-size: 13px;">â±ï¸ å»¶è¿Ÿ</div>
                                    <div style="font-size: 14px; color: #57606a;">${displayItem.metrics.latency}</div>
                                </div>
                            ` : ''}
                            ${displayItem.metrics.throughput && displayItem.metrics.throughput !== 'æœªè¯´æ˜' ? `
                                <div style="padding: 12px; background: #f6f8fa; border-radius: 6px;">
                                    <div style="font-weight: 600; color: #f59e0b; margin-bottom: 6px; font-size: 13px;">ğŸ“Š ååé‡</div>
                                    <div style="font-size: 14px; color: #57606a;">${displayItem.metrics.throughput}</div>
                                </div>
                            ` : ''}
                            ${displayItem.metrics.tokensPerDollar ? `
                                <div style="padding: 12px; background: #f6f8fa; border-radius: 6px;">
                                    <div style="font-weight: 600; color: #1a7f37; margin-bottom: 6px; font-size: 13px;">ğŸ’° æ€§ä»·æ¯”</div>
                                    <div style="font-size: 14px; color: #57606a;">${displayItem.metrics.tokensPerDollar}</div>
                                </div>
                            ` : ''}
                            ${displayItem.metrics.reasoningSteps ? `
                                <div style="padding: 12px; background: #f6f8fa; border-radius: 6px;">
                                    <div style="font-weight: 600; color: #0969da; margin-bottom: 6px; font-size: 13px;">ğŸ§  æ¨ç†æ­¥æ•°</div>
                                    <div style="font-size: 14px; color: #57606a;">${displayItem.metrics.reasoningSteps}</div>
                                </div>
                            ` : ''}
                            ${displayItem.metrics.performance && displayItem.metrics.performance !== 'undefined' ? `
                                <div style="padding: 12px; background: #f6f8fa; border-radius: 6px;">
                                    <div style="font-weight: 600; color: #1a7f37; margin-bottom: 6px; font-size: 13px;">âš¡ æ€§èƒ½</div>
                                    <div style="font-size: 14px; color: #57606a;">${displayItem.metrics.performance}</div>
                                </div>
                            ` : ''}
                            ${displayItem.metrics.accuracy && displayItem.metrics.accuracy !== 'undefined' ? `
                                <div style="padding: 12px; background: #f6f8fa; border-radius: 6px;">
                                    <div style="font-weight: 600; color: #0969da; margin-bottom: 6px; font-size: 13px;">ğŸ¯ å‡†ç¡®æ€§</div>
                                    <div style="font-size: 14px; color: #57606a;">${displayItem.metrics.accuracy}</div>
                                </div>
                            ` : ''}
                            ${displayItem.metrics.efficiency && displayItem.metrics.efficiency !== 'undefined' ? `
                                <div style="padding: 12px; background: #f6f8fa; border-radius: 6px;">
                                    <div style="font-weight: 600; color: #f59e0b; margin-bottom: 6px; font-size: 13px;">ğŸš€ æ•ˆç‡</div>
                                    <div style="font-size: 14px; color: #57606a;">${displayItem.metrics.efficiency}</div>
                                </div>
                            ` : ''}
                        </div>
                        ${displayItem.metrics.additionalMetrics ? `
                            <div style="margin-top: 15px; padding: 12px; background: #fff8e1; border-radius: 6px; border-left: 3px solid #f59e0b;">
                                <div style="font-weight: 600; color: #f59e0b; margin-bottom: 8px;">å…¶ä»–æŒ‡æ ‡</div>
                                <div style="font-size: 13px; color: #57606a; line-height: 1.8;">
                                    ${typeof displayItem.metrics.additionalMetrics === 'object' 
                                        ? Object.entries(displayItem.metrics.additionalMetrics).map(([key, value]) => 
                                            `<strong>${key}:</strong> ${typeof value === 'object' ? JSON.stringify(value) : value}<br>`
                                        ).join('')
                                        : displayItem.metrics.additionalMetrics}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>

                <div class="detail-section">
                    <div class="section-title">ğŸ’¬ è¯„è®ºåŒº</div>
                    <div class="section-content">
                        ${(() => {
                            const itemComments = commentsData[displayItem.id] || {};
                            const status = itemComments.reproductionStatus || 'å·²éªŒè¯';
                            const comments = itemComments.comments || [];
                            
                            return `
                                <div style="margin-bottom: 15px; font-size: 13px; color: #57606a;">
                                    <span style="color: #1a7f37; font-weight: 600;">âœ“ å®éªŒå¤ç°çŠ¶æ€: ${status}</span>
                                </div>
                                <div class="comment-section">
                                    ${comments.length > 0 ? comments.map(comment => `
                                        <div class="comment-item">
                                            <div class="comment-author">@${comment.author || 'åŒ¿åç”¨æˆ·'}</div>
                                            <div class="comment-text">${comment.text || comment.content || ''}</div>
                                            ${comment.date ? `<div style="font-size: 11px; color: #8b949e; margin-top: 4px;">${comment.date}</div>` : ''}
                                        </div>
                                    `).join('') : `
                                        <div style="padding: 20px; text-align: center; color: #8b949e;">
                                            <p>æš‚æ— è¯„è®º</p>
                                            <p style="font-size: 12px; margin-top: 8px;">æ¬¢è¿æ·»åŠ è¯„è®ºå’Œåé¦ˆ</p>
                                        </div>
                                    `}
                                </div>
                            `;
                        })()}
                    </div>
                </div>

                ${showVerificationSection ? `
                <div class="detail-section">
                    <div class="section-title">ğŸ¯ åˆ†çº§éªŒè¯</div>
                    <div class="section-content">
                        <p style="margin-bottom: 10px; font-size: 13px; color: #57606a;">
                            <strong>éªŒè¯çº§åˆ«è¯´æ˜ï¼š</strong><br>
                            â€¢ <strong>Açº§</strong>ï¼šå®Œæ•´å®éªŒï¼ˆåŒ…å«å®Œæ•´ä»£ç å’Œå®éªŒç»†èŠ‚ï¼‰<br>
                            â€¢ <strong>Bçº§</strong>ï¼šå®éªŒä»£ç ä¸å…¨<br>
                            â€¢ <strong>Cçº§</strong>ï¼šä»…å…¬å¸ƒå®éªŒæŒ‡æ ‡
                        </p>
                        <p style="margin-bottom: 15px; margin-top: 15px;">ç‚¹å‡»ç­‰çº§å±•å¼€æŸ¥çœ‹åŸºäºç›¸åŒå®éªŒæ¡ä»¶çš„å¤ç°å®éªŒåˆ—è¡¨ï¼š</p>
                        <div class="verification-levels">
                            <div class="verification-level-item">
                                <div class="verification-badge level-a" data-level="A" data-count="${verification.counts.A}">
                                    <div class="verification-badge-header">
                                        <span class="verification-expand-icon">â–¶</span>
                                        <span>Açº§éªŒè¯</span>
                                        <span class="verification-count">(${verification.counts.A}äºº)</span>
                                    </div>
                                </div>
                                <div class="verification-experiments-list" id="level-a-experiments"></div>
                            </div>
                            <div class="verification-level-item">
                                <div class="verification-badge level-b" data-level="B" data-count="${verification.counts.B}">
                                    <div class="verification-badge-header">
                                        <span class="verification-expand-icon">â–¶</span>
                                        <span>Bçº§éªŒè¯</span>
                                        <span class="verification-count">(${verification.counts.B}äºº)</span>
                                    </div>
                                </div>
                                <div class="verification-experiments-list" id="level-b-experiments"></div>
                            </div>
                            <div class="verification-level-item">
                                <div class="verification-badge level-c" data-level="C" data-count="${verification.counts.C}">
                                    <div class="verification-badge-header">
                                        <span class="verification-expand-icon">â–¶</span>
                                        <span>Cçº§éªŒè¯</span>
                                        <span class="verification-count">(${verification.counts.C}äºº)</span>
                                    </div>
                                </div>
                                <div class="verification-experiments-list" id="level-c-experiments"></div>
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}

                <div class="detail-section">
                    <div class="section-title">ğŸ”— åŸå§‹å†…å®¹é“¾æ¥</div>
                    <div class="section-content">
                        ${originalData.URL || displayItem.sourceUrl || displayItem.paperUrl ? `
                            <a href="${originalData.URL || displayItem.sourceUrl || displayItem.paperUrl}" target="_blank" class="link-item">
                                ğŸ“„ è®ºæ–‡é“¾æ¥: ${originalData.URL || displayItem.sourceUrl || displayItem.paperUrl}
                            </a>
                            <br><br>
                        ` : ''}
                        ${originalData.open_source_components?.code || displayItem.codeUrl || displayItem.githubUrl ? `
                            <a href="${originalData.open_source_components?.code || displayItem.codeUrl || displayItem.githubUrl}" target="_blank" class="link-item">
                                ğŸ’» ä»£ç åº“: ${originalData.open_source_components?.code || displayItem.codeUrl || displayItem.githubUrl}
                            </a>
                            <br><br>
                        ` : `
                            <a href="https://github.com/search?q=${encodeURIComponent(displayItem.name)}" target="_blank" class="link-item">
                                ğŸ’» GitHub ä»£ç åº“
                            </a>
                            <br><br>
                        `}
                        ${originalData.open_source_components?.dataset ? `
                            <a href="${originalData.open_source_components.dataset}" target="_blank" class="link-item">
                                ğŸ“¦ æ•°æ®é›†: ${originalData.open_source_components.dataset}
                            </a>
                            <br><br>
                        ` : ''}
                        ${originalData.open_source_components?.model_weights ? `
                            <p><strong>æ¨¡å‹æƒé‡:</strong> ${originalData.open_source_components.model_weights}</p>
                        ` : ''}
                        ${originalData.hyperparameters ? `
                            <div style="margin-top: 15px; padding: 12px; background: #f6f8fa; border-radius: 6px;">
                                <div style="font-weight: 600; margin-bottom: 8px;">è¶…å‚æ•°é…ç½®:</div>
                                <div style="font-size: 13px;">
                                    ${typeof originalData.hyperparameters === 'object' ? 
                                        Object.entries(originalData.hyperparameters).map(([key, value]) => 
                                            `<p><strong>${key}:</strong> ${value}</p>`
                                        ).join('') 
                                        : `<p>${originalData.hyperparameters}</p>`
                                    }
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // æ¸²æŸ“æ¯ä¸ªçº§åˆ«çš„éªŒè¯å®éªŒåˆ—è¡¨
            renderVerificationLevels(verificationByLevel, displayItem);
            
            // ç»‘å®šéªŒè¯ç­‰çº§ç‚¹å‡»äº‹ä»¶ï¼ˆå±•å¼€/æ”¶èµ·ï¼‰
            document.querySelectorAll('.verification-badge').forEach(badge => {
                badge.addEventListener('click', function() {
                    const level = this.dataset.level;
                    const levelItem = this.closest('.verification-level-item');
                    const experimentsList = levelItem.querySelector('.verification-experiments-list');
                    
                    // åˆ‡æ¢å±•å¼€/æ”¶èµ·
                    this.classList.toggle('expanded');
                    experimentsList.classList.toggle('active');
                });
            });
            
            detailModal.classList.add('active');
        }

        // æ¸²æŸ“æ‰€æœ‰çº§åˆ«çš„éªŒè¯å®éªŒåˆ—è¡¨
        function renderVerificationLevels(verificationByLevel, currentItem) {
            const levelDescriptions = {
                'A': 'å®Œæ•´å®éªŒï¼ˆåŒ…å«å®Œæ•´ä»£ç å’Œå®éªŒç»†èŠ‚ï¼‰',
                'B': 'å®éªŒä»£ç ä¸å…¨',
                'C': 'ä»…å…¬å¸ƒå®éªŒæŒ‡æ ‡'
            };
            
            const levels = ['A', 'B', 'C'];
            
            levels.forEach(level => {
                const listContainer = document.getElementById(`level-${level.toLowerCase()}-experiments`);
                const filteredPoints = verificationByLevel[level] || [];
                
                if (filteredPoints.length === 0) {
                    listContainer.innerHTML = `
                        <p style="color: #57606a; padding: 10px; font-size: 13px;">
                            æš‚æ— ${level}çº§éªŒè¯çš„å¤ç°å®éªŒ<br>
                            <small style="color: #8b949e;">ï¼ˆ${levelDescriptions[level]}ï¼‰</small>
                        </p>
                    `;
                } else {
                    listContainer.innerHTML = `
                        <div style="margin-bottom: 10px; font-size: 12px; color: #57606a;">
                            ${levelDescriptions[level]} | å®éªŒæ¡ä»¶: ${currentItem.conditions}
                        </div>
                        ${filteredPoints.map((point, idx) => `
                            <div class="similar-point-item" data-point-idx="${idx}">
                                <div class="similar-point-name">${point.name}</div>
                                <div class="similar-point-desc">
                                    ${point.date} | ${point.cluster} | ä»·å€¼: ${point.value}
                                </div>
                                <div style="font-size: 12px; color: #8b949e; margin-top: 4px;">
                                    å¤ç°ç»“æœ: ${point.result || 'å¾…éªŒè¯'}
                                </div>
                                ${point.codeUrl ? `<div style="font-size: 11px; color: #0969da; margin-top: 2px;">ğŸ”— ä»£ç : ${point.codeUrl}</div>` : ''}
                                ${point.experimentDetails ? (() => {
                                    const details = [];
                                    if (point.experimentDetails.hyperparameters && point.experimentDetails.hyperparameters !== 'undefined') {
                                        details.push(`ğŸ“‹ è¶…å‚æ•°: ${point.experimentDetails.hyperparameters}`);
                                    }
                                    if (point.experimentDetails.trainingLog && point.experimentDetails.trainingLog !== 'undefined') {
                                        details.push(`è®­ç»ƒæ—¥å¿—: ${point.experimentDetails.trainingLog}`);
                                    }
                                    if (point.experimentDetails.hardware) {
                                        details.push(`ç¡¬ä»¶: ${point.experimentDetails.hardware}`);
                                    }
                                    return details.length > 0 ? `<div style="font-size: 11px; color: #57606a; margin-top: 4px;">${details.join(' | ')}</div>` : '';
                                })() : ''}
                            </div>
                        `).join('')}
                    `;
                    
                    // ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼ˆCçº§éªŒè¯å®éªŒä¸å¯ç‚¹å‡»ï¼Œé¿å…åµŒå¥—ï¼‰
                    listContainer.querySelectorAll('.similar-point-item').forEach((item, idx) => {
                        const point = filteredPoints[idx];
                        // Cçº§éªŒè¯å®éªŒä¸å¯ç‚¹å‡»
                        if (level === 'C') {
                            item.style.cursor = 'default';
                            item.style.opacity = '0.8';
                        } else {
                            // Aå’ŒBçº§éªŒè¯å®éªŒå¯ä»¥ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
                            item.addEventListener('click', async function() {
                                await _showDetailModalInternal(point, true);
                            });
                        }
                    });
                }
            });
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            detailModal.classList.remove('active');
            // å…³é—­æ‰€æœ‰çº§åˆ«çš„å±•å¼€åˆ—è¡¨
            document.querySelectorAll('.verification-experiments-list').forEach(list => {
                list.classList.remove('active');
            });
            document.querySelectorAll('.verification-badge').forEach(badge => {
                badge.classList.remove('expanded');
            });
        }

        // ç»‘å®šå…³é—­æŒ‰é’®
        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', closeModal);
        }

        // ç»‘å®šè¿”å›æŒ‰é’®
        if (backBtn) {
            backBtn.addEventListener('click', function() {
                if (originalItem) {
                    _showDetailModalInternal(originalItem, false);
                }
            });
        }

        // ç‚¹å‡»èƒŒæ™¯å…³é—­
        detailModal.addEventListener('click', function(e) {
            if (e.target === detailModal) {
                closeModal();
            }
        });

        // ESCé”®å…³é—­
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && detailModal.classList.contains('active')) {
                closeModal();
            }
        });

        // å°†showDetailModalæš´éœ²åˆ°å…¨å±€ï¼Œä¾›ç›¸ä¼¼ç‚¹ç‚¹å‡»ä½¿ç”¨
        window.showDetailModal = function(item) {
            // ä»allDataä¸­æ‰¾åˆ°å®Œæ•´æ•°æ®
            const fullItem = allData.find(d => d.id === item.id) || item;
            _showDetailModalInternal(fullItem);
        };

        // ç»‘å®šå½¢çŠ¶ç­›é€‰å™¨çš„changeäº‹ä»¶
        filterGeneral.addEventListener('change', updateChart);
        filterReasoning.addEventListener('change', updateChart);

        // --- å¯åŠ¨ ---
        initChart();

        // å“åº”çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', () => myChart.resize());

    </script>
</body>
</html>

